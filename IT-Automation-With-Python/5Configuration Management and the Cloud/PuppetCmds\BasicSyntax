#puppet files use the .pp file extension
#all variable names are preceded by a '$' in puppet
#write resource types in lowercase when declaring them, upppercase when calling them

sudo apt install puppet-master #installs locally on a linux machine
sudo puppet apply -v tools.pp #installs any package in the tools manifest -v argument=verbose output, shows progress

sudo apt install puppet-module-puppetlabs-apache #installs a prebuilt ruleset for an apache server in 8 seconds
#new manifest, contents below: webserver.pp
include ::apache
sudo puppet apply -v webserver.pp #installs a prebuilt ruleset for an apache server in 8 seconds

sudo puppet config --section master set autosign true #sets certification to autosign for verification
ssh webserver
sudo puppet config set server ubuntu.example.com #sets server to ubuntu.example.com
sudo puppet agent -v --test #does a test run with verbose output
sudo systemctl enable puppet #systemctl controls what programs are started on boot, enable puppet on boot
sudo systemctl start puppet #start puppet on boot

"""basic syntax for a file class"""
class sysctl {

#makes sure the directory exists, some distros don't have it
file { '/etc/sysctl.d':
  ensure => directory,
 }

}

"""basic syntax for timezone file"""
class timezone {

#explicitly states it will be a file, sets contents to UTC time, replace contents of previous file if it exists
file { '/etc/timezone':
  ensure => file,
  content => "UTC\n",
  replace => true,
 }

}

"""basic syntax for a class with multiple resources: a package, a file and a service. It is best practice to group related resources"""
class ntp {
 ensure => latest,
 }
file {'/etc/ntp.conf':
 source =>'puppet://modules/ntp/ntp.conf'
 replace => true,
}
 service {'ntp':
  enable => true,
  ensure => running,
  }
 }
 
 """updated ntp package above with requires and notify added configuration file
 class ntp {
 ensure => latest,
 }
file {'/etc/ntp.conf':
 source =>'puppet://modules/ntp/ntp.conf'
 replace => true,
 require => Package['ntp'],
 notify => Service['ntp']
}
 service {'ntp':
  enable => true,
  ensure => running,
  }
 }
include ntp

"""basic syntax for a virtual machine using a fact variable removes a package if it is a VM installs if isnt"""
 if $facts['is_virtual']{
  package { 'smartmontools':
    ensure => purged,
    
  }
} else {
 package {'smartmontools':
  ensure => installed,
 }
}

"""basic syntax for onlyif idempotent command"""
exec { 'move example file':
 command => 'mv /home/user/example.txt /home/user/Desktop',
 onlyif => 'test -e /home/user/example.txt',
}

"""basic syntax for a node fleet"""
node default {
 class { 'sudo': }
 class { 'ntp':
    servers => ['ntp1.example.com', 'ntp2.example.com']
  }
}

"""basic syntax for apache webserver nodes"""
node webserver.example.com {
 class { 'sudo': }
 class { 'ntp':
    servers => ['ntp1.example.com', 'ntp2.example.com']
  }
  class { 'apache': }
}








